# 数据库的原理

不仅仅局限于`mysql`，作为关系型数据库的代表，还有`no relational database`。所以不如好好探索下什么是数据库。

## 基础原理

### 概念区分

---

**数据库** : 数据库(`DataBase` 简称 DB)就是信息的集合或者说数据库是由数据库管理系统管理的数据的集合。

**数据库管理系统** : 数据库管理系统(`Database Management System `简称 `DBMS`)是一种操纵和管理数据库的大型软件，通常用于建立、使用和维护数据库。

**数据库系统** : 数据库系统(`Data Base System，`简称 `DBS`)通常由软件、数据库和数据管理员(`DBA`)组成。

**数据库管理员** : 数据库管理员(`Database Administrator,` 简称 `DBA`)负责全面管理和控制数据库系统

---

### 数据库基本术语

**元组**：元组（tuple）是关系数据库中的基本概念，关系是一张表，表中的每行（即数据库中的每条记录）就是一个元组，每列就是一个属性。 在二维表里，元组也称为行。

**码**：码就是能唯一标识实体的属性，对应表中的列。

**候选码**：若关系中的某一属性或属性组的值能唯一的标识一个元组，而其任何子集都不能再标识，则称该属性组为候选码。例如：在学生实体中，“学号”是能唯一的区分学生实体的，同时又假设“姓名”、“班级”的属性组合足以区分学生实体，那么{学号}和{姓名，班级}都是候选码。

**主码** : 主码也叫主键。主码是从候选码中选出来的。 一个实体集中只能有一个主码，但可以有多个候选码。

**外码** : 外码也叫外键。如果一个关系中的一个属性是另外一个关系中的主码则这个属性为外码。

**主属性**：候选码中出现过的属性称为主属性。比如关系 工人（工号，身份证号，姓名，性别，部门）. 显然工号和身份证号都能够唯一标示这个关系，所以都是候选码。工号、身份证号这两个属性就是主属性。如果主码是一个属性组，那么属性组中的属性都是主属性。

**非主属性：** 不包含在任何一个候选码中的属性称为非主属性。比如在关系——学生（学号，姓名，年龄，性别，班级）中，主码是“学号”，那么其他的“姓名”、“年龄”、“性别”、“班级”就都可以称为非主属性

------

### 数据库设计

**ER 图** 全称是 `Entity Relationship Diagram`（实体联系图），提供了表示实体类型、属性和联系的方法。

ER 图由下面 3 个要素组成：

- **实体**：通常是现实世界的业务对象，当然使用一些逻辑对象也可以。比如对于一个校园管理系统，会涉及学生、教师、课程、班级等等实体。在 ER 图中，实体使用矩形框表示。
- **属性**：即某个实体拥有的属性，属性用来描述组成实体的要素，对于产品设计来说可以理解为字段。在 ER 图中，属性使用椭圆形表示。
- **联系**：即实体与实体之间的关系，在 ER 图中用菱形表示，这个关系不仅有业务关联关系，还能通过数字表示实体之间的数量对照关系。例如，一个班级会有多个学生就是一种实体间的联系。

关系有

1. 多对多
2. 一对一
3. 一对多

### 数据库范式（设计遵从原则）

`1NF`(第一范式)：属性不可再分。

`2NF`(第二范式)：`1NF` 的基础之上，消除了非主属性对于码的部分函数依赖。

`3NF`(第三范式)：`3NF` 在 `2NF` 的基础之上，消除了非主属性对于码的传递函数依赖 。

#### `1NF`

属性不能再分割。这是关系型数据库最基本的要求

#### `2NF`

主要是增添一个主键，也就是增添了一个列。非主属性都依赖于主键

#### `3NF`

消除传递函数依赖

### 主键和外键有什么区别

**主键(主码)**：主键用于唯一标识一个元组，不能有重复，不允许为空。一个表只能有一个主键。

**外键(外码)**：外键用来和其他表建立联系用，外键是另一表的主键，外键是可以有重复的，可以是空值。一个表可以有多个外键。

### [drop、delete 与 truncate 区别？](#drop、delete-与-truncate-区别)



- `drop`(丢弃数据): `drop table 表名` ，直接将表都删除掉，在删除表的时候使用。
- `truncate` (清空数据) : `truncate table 表名` ，只删除表中的数据，再插入数据的时候自增长 id 又从 1 开始，在清空表中数据的时候使用。
- `delete`（删除数据） : `delete from 表名 where 列名=值`，删除某一行的数据，如果不加 `where` 子句和`truncate table 表名`作用类似。

`truncate` 和不带 `where`子句的 `delete`、以及 `drop` 都会删除表内的数据，但是 **`truncate` 和 `delete` 只删除数据不删除表的结构(定义)，执行 `drop` 语句，此表的结构也会删除，也就是执行`drop` 之后对应的表不复存在。**

同时`truncate`和`drop`属于数据定义语言，不能回滚

## 如何设计一个数据库

1. 需求分析：分析用户的需求
2. 概念结构设计：主要通过E-R模型进行设计
3. 逻辑结构设计：通过将E-R图转换成表
4. 物理结构设计：主要为所涉及的数据库选择合适的存储方式和存储路径
5. 数据库实施：包括编程、测试、试运行
6. 数据库的运行和维护：

## NOSQL

泛指非关系型数据库。主要针对的是键值、文档和图形类型的数据存储。

天生支持分布式、数据冗余和数据分片

这两者的区别

|              | SQL 数据库                                                   | NoSQL 数据库                                                 |
| :----------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 数据存储模型 | 结构化存储，具有固定行和列的表格                             | 非结构化存储。文档：JSON 文档，键值：键值对，宽列：包含行和动态列的表，图：节点和边 |
| 发展历程     | 开发于 1970 年代，重点是减少数据重复                         | 开发于 2000 年代后期，重点是提升可扩展性，减少大规模数据的存储成本 |
| 例子         | Oracle、MySQL、Microsoft SQL Server、PostgreSQL              | 文档：MongoDB、CouchDB，键值：Redis、DynamoDB，宽列：Cassandra、 HBase，图表：Neo4j、 Amazon Neptune、Giraph |
| ACID 属性    | 提供原子性、一致性、隔离性和持久性 (ACID) 属性               | 通常不支持 ACID 事务，为了可扩展、高性能进行了权衡，少部分支持比如 MongoDB 。不过，MongoDB 对 ACID 事务 的支持和 MySQL 还是有所区别的。 |
| 性能         | 性能通常取决于磁盘子系统。要获得最佳性能，通常需要优化查询、索引和表结构。 | 性能通常由底层硬件集群大小、网络延迟以及调用应用程序来决定。 |
| 扩展         | 垂直（使用性能更强大的服务器进行扩展）、读写分离、分库分表   | 横向（增加服务器的方式横向扩展，通常是基于分片机制）         |
| 用途         | 普通企业级的项目的数据存储                                   | 用途广泛比如图数据库支持分析和遍历连接数据之间的关系、键值数据库可以处理大量数据扩展和极高的状态变化 |
| 查询语法     | 结构化查询语言 (SQL)                                         | 数据访问语法可能因数据库而异                                 |

### 优势在哪

1. 灵活性：
2. 可拓展行
3. 高性能
4. 强大的功能

### NOSQL有什么类型

1. 键值：`Redis`
2. 文档：`MongoDB`
3. 图形：
4. 宽列：

## 字符集

在使用中，我们可以看到有设置字符集。

### 为什么要设置字符集

先从定义上看：字符集是一系列字符的集合。通过字符集的规则，可以将一串字符转换成另一串字符。可以说是转换规则。

也就是通常说的字符编码

规则，是人定的，自然就会有多种规则。也就是同样的编码规则。

但因为忒多，所以只需要知道几个常见的`utf8`  `utf8mb4`  `BG2312`  `GBK` `ASCLL` 

其中关键的就在`utf8`、`utf8m64`、`ASCLL`。

关于`unicode`下的字符集为什么还会有两套实现方式，原因也简单。

因为`utf8`最多支持3字节。`utf8mb4`支持四字节。一些表情和繁体字在这个 编码之中。

## SQL语句

已经在其他章节中描述过。基本语法不难，跟英语一样。就是看着挺蛋疼的。

## MYSQL

### 关系型数据库

就是建立在关系模型的护唇膏有上的数据库。关系模型表明了数据库中所存储的数据之间的关系，一对一，一对多，多对多

### 什么是SQL

是结构化查询语言。

//todo: 第二次看的时候再完善。

